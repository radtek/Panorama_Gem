<%
  @update_area = get_unique_area_id

  link_report_id = proc do |rec|
    link_to(fn(rec.report_id),
            url_for(controller:            :dba_history,
                    action:                :list_awr_sql_monitor_report_html,
                    report_id:             rec.report_id,
                    browser_tab_id:        @browser_tab_id
                   ), {method: 'post', target: '_blank', title: "Show SQL-Monitor report in separate browser tab"}
            )
   end

  link_session = proc do |rec|
    ajax_link("#{rec.session_id}, #{rec.session_serialno}", {
               :controller => :active_session_history,
               :action => :show_prepared_active_session_history,
               :update_area => @update_area,
               :instance  => rec.instance_number,
               sql_id:                @sql_id,
               sid:                   rec.session_id,
               serialno:              rec.session_serialno,
               #time_selection_start:  localeDateTime(rec.sql_exec_start),
               #time_selection_end:    localeDateTime(rec.period_end_time),
    }, :title=> t(:dba_list_session_details_link_ash, :default=>'Show wait history of session from Active Session History')
    )
  end

  column_options =
      [
          {:caption=>'Report ID',                   :data=>link_report_id,                                    :title=>'ID of the captured report', align: :right},
          {:caption=>'Inst.',                       :data=>proc{|rec| rec.instance_number},                   :title=>'Instance number'},
          {:caption=>'Sessio-ID / Serialno.',       :data=>link_session,                                      :title=>'Session-ID and serial number of the session corresponding to the captured report (currently used only for SQL Monitor reports)'},
          {:caption=>'Start time',                  :data=>proc{|rec| localeDateTime(rec.period_start_time)}, :title=>'Start of recorded activity'},
          {:caption=>'End time',                    :data=>proc{|rec| localeDateTime(rec.period_end_time)},   :title=>'End of recorded activity'},
          {:caption=>'Duration (Sec.)',             :data=>proc{|rec| fn(rec.duration)},                      :title=>'Duration of activity in seconds', align: :right},
          {:caption=>'SQL exec ID',                 :data=>proc{|rec| fn(rec.key2)},                          :title=>'SQL execution ID', align: :right},
          {:caption=>'SQL exec start',              :data=>proc{|rec| localeDateTime(rec.sql_exec_start)},    :title=>'Start time of execution for this SQL execution ID'},
          {:caption=>'Generation time',             :data=>proc{|rec| localeDateTime(rec.generation_time)},   :title=>'Time when this report was generated'},


      ]

%>

<%=
  gen_slickgrid(@sql_monitor_reports, column_options, {
    caption:        "SQL executions recorded by SQL-Monitor for SQL-ID=#{@sql_id}#{" Instance=#{@instance}" if @instance} from DBA_Hist_Reports",
    max_height:     450,
    show_pin_icon: 1
})
%>


<div id="<%= @update_area%>"></div>




